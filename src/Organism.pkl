import "Core.pkl" as core

const RefSeqRegex = Regex("^GCF_[0-9]+.[0-9]")
const GenBankRegex = Regex("^GCA_[0-9]+.[0-9]")

class GenomeAssembly {
    accession: String(this.matches(RefSeqRegex) || this.matches(GenBankRegex))
    isReference: Boolean

    hidden isRefSeqMatchesAccession = (_) ->
        if (isReference && !determineIsReference(accession))
            throw("GenomeAssemblies that set 'isReference' to true must use the RefSeq (GCF_*) identifier for 'accession'.")
        else true
}

const function determineIsReference(assembly: String): Boolean = assembly.matches(RefSeqRegex)

class Organism {
    name: String
    tags: Listing<String>
    assemblies: Listing<GenomeAssembly>
    attributes: core.OrganismWorkflowMapAnnotation
}